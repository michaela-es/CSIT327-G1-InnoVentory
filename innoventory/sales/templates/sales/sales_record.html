{% extends 'products/base.html' %}
{% load humanize %}

{% block title %}Sales & Transactions{% endblock %}

{% block content %}
<div class="container mt-3">
    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
    </div>
    <h3> Recent Activity </h3>

    <button class="add-button btn btn-primary me-2"
            hx-get="{% url 'record_sale_modal' %}"
            hx-target="#modal-container"
            hx-trigger="click"
            onclick="console.log('Button clicked')">
        Record New Sale
    </button>

    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>ID</th>
                <th>Product</th>
                <th>Qty</th>
                <th>Total</th>
                <th>Type</th>
                <th>Date</th>
                <th>Sold By</th>
            </tr>
        </thead>
        <tbody>
            {% for sale in sales %}
                <tr data-sale-id="{{ sale.sale_id }}">
                    <td>{{ sale.sale_id }}</td>
                    <td>{{ sale.product_sold.name }}</td>
                    <td>{{ sale.product_qty }}</td>
                    <td>{{ sale.total|floatformat:2|intcomma }}</td>
                    <td>{{ sale.get_sales_type_display }}</td>
                    <td>{{ sale.sales_date|date:"n/j/Y" }}</td>
                    <td>
                        {% if sale.sold_by %}
                            {{ sale.sold_by.username }}
                        {% else %}
                            Unknown
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="7">No sales found.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div id="modal-container"></div>

<script>
function closeModal() {
    document.getElementById('modal-container').innerHTML = '';
}
</script>
{% endblock %}