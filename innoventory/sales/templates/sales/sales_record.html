{% extends 'products/base.html' %}
{% load humanize %}

{% block title %}Sales & Transactions{% endblock %}

{% block content %}

<div class="container mt-3">
    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
    </div>
    <h3> Sales & Transactions </h3>
    <button style="margin-bottom: 16px;"
            class="add-button btn btn-primary me-2"
            hx-get="{% url 'record_sale_modal' %}"
            hx-target="#modal-container"
            hx-trigger="click"
            onclick="console.log('Button clicked')">
        <i class="fas fa-plus-circle me-2"></i>
            Record New Sale
    </button>
    <!--static button for now-->
    <button class="btn btn-secondary shadow-sm"
            hx-get="#"
            hx-target="#modal-container"
            hx-trigger="click"
            onclick="console.log('Manage Credits clicked')">
        <i class="fas fa-handshake me-2"></i>
        Manage Credits
    </button>

    <table class="table table-striped table-hover align-middle mb-0">
        <thead class="table-light">
        <tr>
            <th scope="col" style="width: 5%;">ID</th>
            <th scope="col" style="width: 25%;">Product</th>
            <th scope="col" class="text-center" style="width: 10%;">Quantity</th>
            <th scope="col" class="text-end" style="width: 15%;">Total</th>
            <th scope="col" style="width: 10%;">Type</th>
            <th scope="col" style="width: 15%;">Date</th>
            <th scope="col" style="width: 20%;">Sold By</th>
        </tr>
        </thead>
        <tbody>
        {% for sale in sales %}
        <tr data-sale-id="{{ sale.sale_id }}">
            <td class="text-muted">{{ sale.sale_id }}</td>
            <td class="fw-bold">{{ sale.product_sold.name }}</td>
            <td class="text-center">{{ sale.product_qty|intcomma }}</td>
            <td class="text-end text-success fw-bold">â‚±{{ sale.total|floatformat:2|intcomma }}</td>
            <td>
                <span class="badge {% if sale.sales_type == 'CASH' %}bg-primary{% else %}bg-info{% endif %}">{{ sale.get_sales_type_display }}</span>
            </td>
            <td>{{ sale.sales_date|date:"M j, Y" }}</td>
            <td>
                {% if sale.sold_by %}
                <i class="fas fa-user me-1"></i> {{ sale.sold_by.username }}
                {% else %}
                <span class="text-danger">Unknown</span>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="7" class="text-center py-4 text-muted">
                <i class="fas fa-file-invoice-dollar fa-2x mb-2"></i><br>
                No sales found. Record your first sale to start tracking activity.
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<div id="modal-container"></div>

<script>
function closeModal() {
    document.getElementById('modal-container').innerHTML = '';
}
</script>
{% endblock %}