<div class="modal fade" id="deleteProductModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="modalMessages"></div> <!-- place for messages -->
                <p>Are you sure you want to delete <strong id="deleteItemName"></strong>?</p>
                <p class="text-danger"><small>This action cannot be undone.</small></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteForm" method="post" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
const deleteModal = document.getElementById('deleteConfirmModal');
const deleteItemName = document.getElementById('deleteItemName');
const deleteForm = document.getElementById('deleteForm');
const modalMessages = document.getElementById('modalMessages');

deleteModal.addEventListener('show.bs.modal', function(event) {
    const button = event.relatedTarget;
    const productId = button.getAttribute('data-product-id');
    const productName = button.getAttribute('data-product-name');

    deleteItemName.innerHTML = `<strong>${productName}</strong>`;
    deleteForm.action = `/products/delete/${productId}/`;
    modalMessages.innerHTML = '';
});

deleteForm.addEventListener('submit', function(e) {
    e.preventDefault();

    modalMessages.innerHTML = '';

    fetch(deleteForm.action, {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => {
        if (response.redirected) {
            window.location.href = response.url;
        } else {
            return response.text();
        }
    })
    .then(data => {
        if (data) {
            modalMessages.innerHTML = `<div class="alert alert-danger">${data}</div>`;
        }
    })
    .catch(err => {
        modalMessages.innerHTML = `<div class="alert alert-danger">An unexpected error occurred.</div>`;
    });
});
</script>
